<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>บันทึกการเยี่ยมผู้ป่วย</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-4 max-w-2xl">
    <h1 class="text-2xl font-bold text-center mb-6">บันทึกการเยี่ยมผู้ป่วย</h1>
    <form id="patientForm" enctype="multipart/form-data" class="bg-white p-6 rounded-lg shadow-md">
      <!-- ชื่อ-นามสกุล CG -->
      <div class="mb-4">
        <label for="cg_name" class="block text-sm font-medium text-gray-700">ชื่อ-นามสกุล (CG)</label>
        <input type="text" id="cg_name" name="cg_name" required
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
      </div>

      <!-- ชื่อผู้ป่วย -->
      <div class="mb-4">
        <label for="patient_name" class="block text-sm font-medium text-gray-700">ชื่อผู้ป่วย</label>
        <input type="text" id="patient_name" name="patient_name" required
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
      </div>

      <!-- บ้านเลขที่ -->
      <div class="mb-4">
        <label for="house_number" class="block text-sm font-medium text-gray-700">บ้านเลขที่</label>
        <input type="text" id="house_number" name="house_number"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
      </div>

      <!-- หมู่ที่ -->
      <div class="mb-4">
        <label for="village" class="block text-sm font-medium text-gray-700">หมู่ที่</label>
        <input type="text" id="village" name="village"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
      </div>

      <!-- อายุ -->
      <div class="mb-4">
        <label for="age" class="block text-sm font-medium text-gray-700">อายุ</label>
        <input type="number" id="age" name="age"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
      </div>

      <!-- กลุ่มผู้ป่วย -->
      <div class="mb-4">
        <label for="patient_group" class="block text-sm font-medium text-gray-700">กลุ่มผู้ป่วย</label>
        <select id="patient_group" name="patient_group"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
          <option value="">เลือกกลุ่ม</option>
          <option value="กลุ่มที่ 1 ติดบ้าน">กลุ่มที่ 1 ติดบ้าน</option>
          <option value="กลุ่มที่ 2 ติดเตียง">กลุ่มที่ 2 ติดเตียง</option>
        </select>
      </div>

      <!-- ออกเยี่ยมครั้งที่ -->
      <div class="mb-4">
        <label for="visit_number" class="block text-sm font-medium text-gray-700">ออกเยี่ยมครั้งที่</label>
        <input type="text" id="visit_number" name="visit_number"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
      </div>

      <!-- วันที่ออกเยี่ยม -->
      <div class="mb-4">
        <label for="visit_date" class="block text-sm font-medium text-gray-700">วันที่ออกเยี่ยม</label>
        <input type="date" id="visit_date" name="visit_date"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
      </div>

      <!-- เวลาที่ออกเยี่ยม -->
      <div class="mb-4">
        <label for="visit_time" class="block text-sm font-medium text-gray-700">เวลาที่ออกเยี่ยม</label>
        <input type="time" id="visit_time" name="visit_time"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
      </div>

      <!-- ความดันโลหิต -->
      <div class="mb-4">
        <label for="blood_pressure" class="block text-sm font-medium text-gray-700">ความดันโลหิต</label>
        <input type="text" id="blood_pressure" name="blood_pressure"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
      </div>

      <!-- ชีพจร -->
      <div class="mb-4">
        <label for="pulse" class="block text-sm font-medium text-gray-700">ชีพจร</label>
        <input type="text" id="pulse" name="pulse"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
      </div>

      <!-- อุณหภูมิร่างกาย -->
      <div class="mb-4">
        <label for="temperature" class="block text-sm font-medium text-gray-700">อุณหภูมิร่างกาย</label>
        <input type="text" id="temperature" name="temperature"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
      </div>

      <!-- เจาะน้ำตาลในเลือด DTX -->
      <div class="mb-4">
        <label for="dtx" class="block text-sm font-medium text-gray-700">เจาะน้ำตาลในเลือด DTX</label>
        <input type="text" id="dtx" name="dtx"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
      </div>

      <!-- โรค -->
      <div class="mb-4">
        <label for="disease" class="block text-sm font-medium text-gray-700">โรค</label>
        <input type="text" id="disease" name="disease"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
      </div>

      <!-- สภาพปัญหาที่พบ -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700">สภาพปัญหาที่พบ</label>
        <div class="mt-2 space-y-2">
          <label class="flex items-center">
            <input type="checkbox" name="symptoms" value="1.ไม่สามารถควบคุมระดับน้ำตาลในเลือดได้"
                   class="rounded text-indigo-600 focus:ring-indigo-500">
            <span class="ml-2">ไม่สามารถควบคุมระดับน้ำตาลในเลือดได้</span>
          </label>
          <label class="flex items-center">
            <input type="checkbox" name="symptoms" value="2.พฤติกรรมการบริโภคไม่เหมาะสม"
                   class="rounded text-indigo-600 focus:ring-indigo-500">
            <span class="ml-2">พฤติกรรมการบริโภคไม่เหมาะสม</span>
          </label>
          <label class="flex items-center">
            <input type="checkbox" name="symptoms" value="3.เสี่ยงต่อโรคหลอดเลือดหัวใจ หลอดเลือดสมอง"
                   class="rounded text-indigo-600 focus:ring-indigo-500">
            <span class="ml-2">เสี่ยงต่อโรคหลอดเลือดหัวใจ หลอดเลือดสมอง</span>
          </label>
          <label class="flex items-center">
            <input type="checkbox" name="symptoms" value="4.เสี่ยงต่อการหกล้ม"
                   class="rounded text-indigo-600 focus:ring-indigo-500">
            <span class="ml-2">เสี่ยงต่อการหกล้ม</span>
          </label>
        </div>
      </div>

      <!-- กิจกรรมการดูแล -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700">กิจกรรมการดูแล</label>
        <div class="mt-2 space-y-2">
          <label class="flex items-center">
            <input type="checkbox" name="management" value="1. แนะนำรู้เรื่องโรค และ ดูแลการเจ็บป่วย"
                   class="rounded text-indigo-600 focus:ring-indigo-500">
            <span class="ml-2">แนะนำรู้เรื่องโรค และ ดูแลการเจ็บป่วย</span>
          </label>
          <label class="flex items-center">
            <input type="checkbox" name="management" value="2. ให้ความรู้เกี่ยวกับการป้องกันภาวะแทรกซ้อน"
                   class="rounded text-indigo-600 focus:ring-indigo-500">
            <span class="ml-2">ให้ความรู้เกี่ยวกับการป้องกันภาวะแทรกซ้อน</span>
          </label>
          <label class="flex items-center">
            <input type="checkbox" name="management" value="3. ปรับโภชนาการให้เหมาะสมกับโรค อาหาร 3 กลุ่ม"
                   class="rounded text-indigo-600 focus:ring-indigo-500">
            <span class="ml-2">ปรับโภชนาการให้เหมาะสมกับโรค อาหาร 3 กลุ่ม</span>
          </label>
          <label class="flex items-center">
            <input type="checkbox" name="management" value="4. แนะนำการรับประทานยาและตรวจตามนัด"
                   class="rounded text-indigo-600 focus:ring-indigo-500">
            <span class="ml-2">แนะนำการรับประทานยาและตรวจตามนัด</span>
          </label>
        </div>
      </div>

      <!-- อารมณ์ -->
      <div class="mb-4">
        <label for="emotion" class="block text-sm font-medium text-gray-700">ประเมิน อารมณ์ผู้สูงอายุ</label>
        <select id="emotion" name="emotion"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
          <option value="">เลือกอารมณ์</option>
          <option value="ดี">ดี</option>
          <option value="ปกติ">ปกติ</option>
          <option value="ไม่ดี">ไม่ดี</option>
        </select>
      </div>

      <!-- อาการเปลี่ยนแปลง -->
      <div class="mb-4">
        <label for="condition_change" class="block text-sm font-medium text-gray-700">ประเมิน อาการผู้ป่วยแตกต่างจากครั้งที่แล้ว</label>
        <select id="condition_change" name="condition_change"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
          <option value="">เลือกอาการ</option>
          <option value="คงที่">คงที่</option>
          <option value="ดีขึ้น">ดีขึ้น</option>
          <option value="แย่ลง">แย่ลง</option>
        </select>
      </div>

      <!-- อัปโหลดรูปภาพ -->
      <div class="mb-4">
        <label for="image_upload" class="block text-sm font-medium text-gray-700">อัปโหลดรูปภาพ</label>
        <input type="file" id="image_upload" name="image_upload" accept="image/jpeg,image/png,image/gif"
               class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
      </div>

      <!-- ปุ่มส่ง -->
      <div class="text-center">
        <button type="submit"
                class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
          ส่งข้อมูล
        </button>
      </div>
    </form>
  </div>

  <script>
    // แทนที่ด้วย Web App URL ของคุณ
    const webAppUrl = 'https://script.google.com/macros/s/AKfycbxbxwMA9HTYulCB4O8rrXjTLMjMJLDrY17wn4j1DTebpJBXiijJHLzew320IPQXZOSF/exec';

    const form = document.getElementById('patientForm');
    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      const formData = new FormData(form);
      const imageInput = document.getElementById('image_upload');

      // ตรวจสอบไฟล์รูปภาพ
      if (imageInput.files.length > 0) {
        const file = imageInput.files[0];
        console.log('Image selected:', file.name, 'Size:', file.size, 'Type:', file.type);
        if (file.size > 5 * 1024 * 1024) {
          alert('ไฟล์รูปภาพต้องมีขนาดไม่เกิน 5MB');
          return;
        }
        if (!['image/jpeg', 'image/png', 'image/gif'].includes(file.type)) {
          alert('กรุณาเลือกไฟล์ .jpg, .png, หรือ .gif');
          return;
        }
      } else {
        console.log('No image selected');
      }

      // Log FormData
      console.log('FormData entries:');
      for (let [key, value] of formData.entries()) {
        console.log(`${key}: ${typeof value === 'object' ? '[File]' : value}`);
      }

      try {
        console.log('Submitting form to:', webAppUrl);
        const response = await fetch(webAppUrl, {
          method: 'POST',
          body: formData
        });
        console.log('Response status:', response.status);
        const responseText = await response.text();
        console.log('Response text:', responseText);
        alert(responseText === 'Success' ? 'ส่งข้อมูลสำเร็จ' : 'เกิดข้อผิดพลาด: ' + responseText);
      } catch (error) {
        console.error('Error submitting form:', error);
        alert('เกิดข้อผิดพลาดในการส่งฟอร์ม: ' + error.message);
      }
    });
  </script>
</body>
</html>