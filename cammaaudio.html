<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üéµ Camma Audio Player</title>

  <!-- Google Fonts: Prompt -->
  <link href="https://fonts.googleapis.com/css2?family=Prompt :wght@400;600&display=swap" rel="stylesheet"/>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap @5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    body {
      font-family: 'Prompt', sans-serif;
      background-color: #f0f4f8;
      padding: 2rem;
    }

    h1 {
      text-align: center;
      margin-bottom: 2rem;
      font-weight: 600;
    }

    .playlist-container {
      max-width: 700px;
      margin: auto;
    }

    .song-card {
      cursor: pointer;
      transition: transform 0.2s ease;
      background-color: #ffffff;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .song-card:hover {
      transform: scale(1.02);
    }

    .song-title {
      font-size: 1.1rem;
      font-weight: 500;
    }

    audio {
      width: 100%;
      margin-top: 1rem;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>üéµ Camma Audio Player</h1>

    <div id="playlist" class="playlist-container"></div>

    <div class="mt-4">
      <audio id="audioPlayer" class="w-100" controls></audio>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap @5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbweEaFAfNObhLf0DqHs7xUNR4YeG8MyEwBkW5NZxnselZnnup4SgYxrFGs_9IrGkn_m/exec";

    let songs = [];
    let currentSongIndex = 0;

    fetch(GAS_URL)
      .then(res => res.json())
      .then(data => {
        songs = data.filter(song => song.url && isAudioUrlSupported(song.url));
        if (songs.length === 0) {
          document.getElementById("playlist").innerHTML = `
            <div class="alert alert-warning text-center">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ</div>`;
          return;
        }
        renderPlaylist();
        loadAndPlay(currentSongIndex);
      })
      .catch(err => {
        console.error("Error loading songs:", err);
        document.getElementById("playlist").innerHTML = `
          <div class="alert alert-danger text-center">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>`;
      });

    function isAudioUrlSupported(url) {
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö
      return /\.(mp3|wav|ogg|m4a)$/i.test(url);
    }

    function renderPlaylist() {
      const playlist = document.getElementById("playlist");
      playlist.innerHTML = "";
      songs.forEach((song, index) => {
        const div = document.createElement("div");
        div.className = "song-card";
        div.innerHTML = `<div class="song-title">${song.title}</div>`;
        div.onclick = () => loadAndPlay(index);
        playlist.appendChild(div);
      });
    }

    function loadAndPlay(index) {
      currentSongIndex = index;
      const song = songs[index];
      const audio = document.getElementById("audioPlayer");
      audio.src = song.url;
      audio.play()
        .catch(err => console.error("‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err));
    }

    const audio = document.getElementById("audioPlayer");
    audio.addEventListener("ended", () => {
      currentSongIndex = (currentSongIndex + 1) % songs.length;
      loadAndPlay(currentSongIndex);
    });
  </script>

</body>
</html>